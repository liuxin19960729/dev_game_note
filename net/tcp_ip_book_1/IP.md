## 引言
```
ip 不可靠
  原因 1.路由器用完缓冲区 丢弃数据--发送icmp给信号源
  ....
无连接 
    ip不维护数据包状态
    可以任意顺序进行发送数据
    接收数据无顺序(原因同一台机器发送数据源可能数据走的线路不是同一条所以会造成发送数据和接收数据可能不一致的情况)


```


## ip首部
```
对齐大小4byte (0-31)bit

1. 0                                                 31
   4bit:版本 0100B  4 version  ipv4
   4bit 首部长度  0101 (5*4=20)  max 1111B*4=60 byte  普通ip数据未5
   8bit 服务类型(tos)
        3bit 优先权字段(现以被忽略)
        4bit
            1000 最小延迟
            0100 最大吞吐
            0010 最高可靠
            0001 最小费用

            注意：0000代表的是一般的服务

        1bit
            未用位必须设置为0
   16位总长度 0x004c(76)
      整个ip 数据包的长度
      虽然最长可以设置2^16-1==65535 但是最大mtu 和路径mtu不允许这么大所以设置这么大的时候会被分片

2 0                                             31
  16位标识(例:0xf265)
    唯一的表示主机发送每一份数据报-->通常 发送一分 count+1
  3位标识
  13位片偏移

3. 0                                            31
   8位生存时间
     ttl(time-to-live) 数据报可以经过的最多路由数(例:0x40)
     值的初始由主机进行设置 (32|64) 经过一个路由器-1,当数据减为0的时候丢弃数据包-->并且发送icmp告诉发送的数据的源主机(我把你发送的数据丢弃 了)

   8位协议
       TCP UDP  TCP IGMP 等 传输层的协议 
   16位首部检测和码
        tcp icmp udp  igmp 都存在检测和码(都采用相同的算法)
        怎么出来计算出来的： 根据ip首部计算出来的码(ip数据包的前20个byte计算出来的)

        计算流程
            1.先设置为0x0000
            2.对首部每个16位 进行二进制反码求和
            3.存在首部检测和码里面
           
            4.接收到数据时 首部进行反码求和
               例：
               计算接收到的数据 ip首部 反码求 1011 
               cheksum 反码 0100 
               相加就是我们需要计算的 1111
               16位全为1 正确

               不为全为1 错误 
                 丢弃 会从传 

      因为我们经过一个路由器 ttl(最大限制路由数) 数-1,检测数量  checksum +1
      所以在路由器传输数据是不需用重新计算检测码的。

      标准bsd并不采用上面的那种方式
4.  32位源ip地址

5.  32目的ip地址

6.选项
   这些选项很少被使用
   
7. 数据
 
```

## IP路由的选择
```
IP层配置功能
  1.主机
  2.路由器(转发数据)
ip层在内存里面是有一个路由表的

ip层接接收数据并发送--查询路由表
                    检测数据的ip是否是本机地址之一或者是ip广播
                            ------- 是 送到 对应的协议进行处理

                                    否
                                       1.设置了路由功能对数据进行转发
                                       2.为设置路由功能 丢弃数据

路由表
    目的ip 
      值为0代表所有主机

    下一站路由器的ip

    标志
       ip 网络地址 还是主机地址
       是否为真的下一站路由器
    为数据报指定一个网络接口   


路由器的选择是逐跳地进行(任何一个路由器并不知道目的地址完整的路劲详细--除了点对点的连接)  
```

## 子网寻址
```
若一个B类网络
   [前16位 140.252]+[8位 子网号]+[8位 主机号]  

```

## 子网掩码
```
作用：除了ip地址以外，主机还需要多少比特用于子网号和主机号

子网掩码总共32bit

bit ==1 是留给网络号和子网号的
0 是留给主机号的
第一种子网掩码
   0x ff ff ff 00
当本机ip  140.252.1.1
目的ip  140.252.4.5
分析目的IP  本机IP  子网掩码  可以知道  目的ip和本地ip网络号是相等的

第二种子网掩码
   0x ff ff ff co   


```